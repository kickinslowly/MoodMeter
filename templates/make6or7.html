{% extends "base.html" %}

{% block title %}Make 6 or 7{% endblock %}

{% block body_attrs %} data-user-id="{{ current_user.id or '' }}"{% endblock %}

{% block content %}
  <div class="page make67-page">
    <header class="header">
      <!-- Mobile hamburger menu button -->
      <button id="mobileMenuBtn" class="mobile-menu-btn" aria-label="Open menu" aria-expanded="false">
        <span class="hamburger-icon"></span>
      </button>

      <!-- Desktop navigation links -->
      <div class="desktop-nav">
        <a href="{{ url_for('home') }}" class="make67-btn" title="Back to Home">Home</a>
      </div>

      <div class="header-right">
        <!-- Game Dock - desktop only, mobile uses drawer -->
        <div class="game-dock header-dock" role="group" aria-label="Game Dock">
          <button id="m67InvBtn" class="dock-btn" title="Inventory">ğŸ’</button>
          <button id="m67ShopBtn" class="dock-btn" title="Shop">ğŸ›’</button>
          <button id="btn-toggle-chat" class="dock-btn" title="Chat">ğŸ’¬</button>
          <button id="btn-mobile-rank" class="dock-btn mobile-only" title="Rank">ğŸ†</button>
          <button id="m67SoundBtn" class="dock-btn" title="Select Solve Sound" aria-haspopup="listbox" aria-expanded="false">ğŸ”Š</button>
          <button id="m67ThemeBtn" class="dock-btn" title="Color Theme" aria-haspopup="listbox" aria-expanded="false" style="display:none;">ğŸ¨</button>
        </div>
        <div class="auth-actions">
          {% if current_user.is_authenticated %}
            <img class="avatar" src="{{ current_user.avatar_url or '' }}" alt="Avatar" onerror="this.style.display='none'">
            <span class="user-name">{{ current_user.name or current_user.email }}</span>
            <form method="post" action="{{ url_for('logout_view') }}" style="display:inline-block; margin-left:8px;">
              <button type="submit" class="logout-btn" title="Sign out">Logout</button>
            </form>
          {% else %}
            <a href="{{ url_for('login_view') }}" class="google-login-btn" title="Sign in with Google">Sign in with Google</a>
          {% endif %}
        </div>
      </div>

      <h1 class="title">Make 6 or 7</h1>
      <div class="subtitle">Use only + âˆ’ to combine all 4 cards and make 6 or 7</div>
    </header>

    <!-- Mobile Navigation Drawer -->
    <div id="mobileNavDrawer" class="mobile-nav-drawer" hidden>
      <div class="mobile-nav-backdrop" data-close-nav="1"></div>
      <nav class="mobile-nav-panel" role="navigation" aria-label="Mobile navigation">
        <div class="mobile-nav-header">
          <span class="mobile-nav-title">Menu</span>
          <button class="mobile-nav-close" aria-label="Close menu" data-close-nav="1">âœ•</button>
        </div>

        <div class="mobile-nav-section">
          <div class="mobile-nav-section-title">Navigation</div>
          <a href="{{ url_for('home') }}" class="mobile-nav-link">Home</a>
        </div>

        <div class="mobile-nav-section">
          <div class="mobile-nav-section-title">Game</div>
          <button class="mobile-nav-link" data-action="inventory">ğŸ’ Inventory</button>
          <button class="mobile-nav-link" data-action="shop">ğŸ›’ Shop</button>
          <button class="mobile-nav-link" data-action="chat">ğŸ’¬ Chat</button>
          <button class="mobile-nav-link" data-action="leaderboard">ğŸ† Leaderboard</button>
          <button class="mobile-nav-link" data-action="sound">ğŸ”Š Solve Sound</button>
          <button class="mobile-nav-link" data-action="theme" id="mobileThemeLink" style="display:none;">ğŸ¨ Color Theme</button>
        </div>

        <div class="mobile-nav-section mobile-nav-auth">
          {% if current_user.is_authenticated %}
            <div class="mobile-nav-user">
              <img class="avatar" src="{{ current_user.avatar_url or '' }}" alt="" onerror="this.style.display='none'">
              <span>{{ current_user.name or current_user.email }}</span>
            </div>
            <form method="post" action="{{ url_for('logout_view') }}">
              <button type="submit" class="mobile-nav-link mobile-nav-logout">Sign Out</button>
            </form>
          {% else %}
            <a href="{{ url_for('login_view') }}" class="mobile-nav-link mobile-nav-signin">Sign in with Google</a>
          {% endif %}
        </div>
      </nav>
    </div>

    <main class="split-layout">
      <aside class="panel-left">
        <div class="stats-hud">
          <div class="stat-row">
            <div class="stat-item score-box">
              <span class="label">Session</span>
              <span id="m67Score" class="value">0</span>
            </div>
            <div class="stat-item gold score-box">
              <span class="label">Lifetime Solves</span>
              <span id="m67AllTime" class="value">--</span>
            </div>
          </div>
          <div id="m67Effects" class="effects-bar"></div>
        </div>

        <div class="leaderboard-container">
          <h3 class="lb-header">Top 10</h3>
          <ol id="m67Leaderboard" class="lb-list"></ol>
        </div>

        <div class="panel-footer"></div>
      </aside>

      <section class="panel-right">
        <div class="game-board-wrapper">
          <button id="hintBtn" class="shoulder-btn left" title="Hint (H)">?</button>
          <button id="resetBtn" class="shoulder-btn right" title="Reset (R)">â†º</button>

          <div class="cards-grid" role="grid" aria-label="Number cards">
            <button class="card" data-index="0" role="gridcell" aria-label="Card 1"><span>0</span></button>
            <button class="card" data-index="1" role="gridcell" aria-label="Card 2"><span>0</span></button>
            <button class="card" data-index="2" role="gridcell" aria-label="Card 3"><span>0</span></button>
            <button class="card" data-index="3" role="gridcell" aria-label="Card 4"><span>0</span></button>
          </div>

          <div class="ops" aria-label="Operations">
            <button class="op-btn" data-op="+">ï¼‹</button>
            <button class="op-btn" data-op="-">âˆ’</button>
          </div>
          <div class="note" id="m67Hint" aria-live="polite"></div>
        </div>

        {% if make67_chat_eligible %}
        <div id="chat-overlay" class="glass-overlay" hidden>
          <div class="m67-chat glass-panel" aria-label="Live chat (Make)">
            <button class="m67-modal__close" aria-label="Close chat" data-close-chat="1">âœ•</button>
            <h3 class="m67-chat__title">Live Chat</h3>
            <div id="m67ChatLog" class="m67-chat__log" aria-live="polite"></div>
            <form id="m67ChatForm" class="m67-chat__form" autocomplete="off">
              <input id="m67ChatInput" type="text" maxlength="300" placeholder="Say something" class="m67-chat__input" />
              <button type="submit" class="op-btn">Send</button>
            </form>
          </div>
        </div>
        {% else %}
        <div id="chat-overlay" class="glass-overlay" hidden></div>
        {% endif %}

      </section>
    </main>

    <!-- Success overlay -->
    <div class="m67-overlay-root" hidden>
      <div class="m67-overlay">
        <div class="m67-overlay__backdrop"></div>
        <div class="m67-overlay__panel">
          <div class="m67-overlay__glow"></div>
          <div class="m67-overlay__icon">ğŸ‰</div>
          <div class="m67-overlay__title">6 or 7! Nicely done</div>
          <button id="nextPuzzleBtn" class="neon-btn" style="margin-top:14px;">New puzzle</button>
        </div>
      </div>
    </div>

    <!-- Cheater Wall of Shame modal -->
    <div class="m67-ban-root" hidden>
      <div class="m67-ban-overlay">
        <div class="m67-ban__backdrop" data-close="1"></div>
        <div class="m67-ban__panel" role="dialog" aria-modal="true" aria-labelledby="banTitle">
          <button class="m67-ban__close" aria-label="Close" data-close="1">âœ•</button>
          <div class="m67-ban__icon" aria-hidden="true">ğŸš«</div>
          <h3 id="banTitle" class="m67-ban__title">Cheater Wall of Shame</h3>
          <p class="m67-ban__subtitle">These users are removed from the allâ€‘time leaderboard.</p>
          <ol id="m67BannedList" class="m67-lb-list" aria-live="polite" style="width:min(100%,520px);"></ol>
        </div>
      </div>
    </div>

    <!-- Inventory modal -->
    <div class="m67-modal-root m67-inv-root" hidden>
      <div class="m67-modal-overlay">
        <div class="m67-modal__backdrop" data-close="1"></div>
        <div class="m67-modal__panel" role="dialog" aria-modal="true" aria-labelledby="invTitle">
          <button class="m67-modal__close" aria-label="Close" data-close="1">âœ•</button>
          <h3 id="invTitle" class="m67-modal__title">Inventory</h3>
          <div id="m67Inv" class="m67-inv" style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; width:min(100%,560px);"></div>
          <div id="m67Effects" class="m67-effects" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; font-size:13px; color:#ccd1db; opacity:.9; margin-top:10px;"></div>
        </div>
      </div>
    </div>

    <!-- Shop modal -->
    <div class="m67-modal-root m67-shop-root" hidden>
      <div class="m67-modal-overlay">
        <div class="m67-modal__backdrop" data-close="1"></div>
        <div class="m67-modal__panel" role="dialog" aria-modal="true" aria-labelledby="shopTitle">
          <button class="m67-modal__close" aria-label="Close" data-close="1">âœ•</button>
          <h3 id="shopTitle" class="m67-modal__title">Shop</h3>
          <div id="m67ShopNote" style="text-align:center; color:#ccd1db; font-size:13px; margin-bottom:10px;"></div>
          <div id="m67ShopList" class="m67-shop" style="display:grid; grid-template-columns: repeat(3, minmax(120px, 1fr)); gap:10px; width:min(100%,640px);"></div>
        </div>
      </div>
    </div>

    <!-- Rank Up Hype Overlay -->
    <div id="rankUpOverlay" class="rank-up-overlay" style="display: none; pointer-events: none;">
      <div class="rank-up-content">
        <h2 class="rank-up-header">âš ï¸ RANK UP! âš ï¸</h2>
        <div class="rank-up-names" id="rankUpNames">NOOB â†’ ROOKIE</div>
        <div class="rank-up-flavor" id="rankUpFlavor">BRAIN EXPANDING...</div>
      </div>
    </div>

  </div>

  <button
    id="m67BannedBtn"
    class="text-link"
    style="position:fixed; left:12px; bottom:10px; font-size:12px; opacity:.75; z-index:3; text-decoration:underline; background:transparent; border:0;"
    title="View Cheater Wall of Shame"
  >Wall of Shame</button>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/make6or7.js') }}"></script>
  {% include '_audio_elements.html' %}
{% endblock %}
